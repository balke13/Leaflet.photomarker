L.PhotoIcon=L.Class.extend({options:{className:"leaflet-photomarker-img"},initialize:function(i){L.setOptions(this,i),this.original_size=L.point(i.size),this.size=this.original_size},scale:function(i){var e=this.original_size.multiplyBy(i);e.x!==this.size.x&&e.y!==this.size.y&&this.resize(e)},createIcon:function(){var i=this.options.src;if(!i){if("icon"===name)throw Error("iconUrl not set in Icon options (see the docs).");return null}return this._container=L.DomUtil.create("div","leaflet-photomarker-container"),this._container.style.position="relative",this.img=this._createImg(i),this._container.appendChild(this.img),L.DomUtil.addClass(this.img,"leaflet-marker-icon"),L.DomUtil.addClass(this.img,this.options.className),this._setIconSize(this.img,this.size),this._container},resize:function(i){this.size=i,this._setIconSize(this.img,this.size)},createShadow:function(){return null},_setIconSize:function(i,e){var t=e.divideBy(2,!0);t&&(i.style.marginLeft=-t.x+"px",i.style.marginTop=-t.y+"px"),e&&(i.style.width=e.x+"px",i.style.height=e.y+"px")},_createImg:function(i){var e;return L.Browser.ie6?(e=document.createElement("div"),e.style.filter='progid:DXImageTransform.Microsoft.AlphaImageLoader(src="'+i+'")'):(e=document.createElement("img"),e.src=i),e}}),L.PhotoMarker=L.Marker.extend({options:{title:"",smallestSizeZoom:11,fullSizeZoom:16,scaleTo:.25,clickable:!0,draggable:!1,zIndexOffset:0,opacity:1,riseOnHover:!0,riseOffset:250},initialize:function(i,e){e.icon=new L.PhotoIcon({src:e.src,size:e.size}),L.Marker.prototype.initialize.call(this,i,e)},_initIcon:function(){L.Marker.prototype._initIcon.call(this),this.resize()},onAdd:function(i){i.on("zoomend",this.resize,this),L.Marker.prototype.onAdd.call(this,i)},onRemove:function(i){i.off("zoomend",this.resize,this),L.Marker.prototype.onRemove.call(this,i)},scale:function(i){var e=this.options.icon;e.scale(i)},resize:function(){"function"==typeof this.options.resize?this.options.resize.call(this,this._map):this._resize(this._map)},_resize:function(i){var e=this,t=i.getZoom(),o=this.options.smallestSizeZoom,s=this.options.fullSizeZoom,n=this.options.scaleTo,r=s-t,a=s-o;if(t>=s)e.scale(1);else if(o>t)e.scale(n);else{var l=1-(1-n)/a*r;e.scale(l)}}}),L.photoMarker=function(i,e){return new L.PhotoMarker(i,e)};